function floatype(l,e={}){const o={onQuery:null,onNavigate:null,onSelect:null,onRender:null,debounce:100,...e};let s,a=0,i=[],t,n;const r=function(){var e=document.createElement("div"),t=(document.querySelector("body").appendChild(e),window.getComputedStyle(l));for(const n of t)e.style[n]=t[n];return e.style.visibility="hidden",e.style.position="absolute",e.style.left="-500%",e.style.top="-500%",e}();function u(e){"keydown"===e.type&&function(e){if(!s)return 1;switch(e.keyCode){case 38:return d(-1,e),0;case 40:return d(1,e),0;case 9:case 32:case 13:return e.preventDefault(),f(a),void p();case 27:return p(),1}}(e)||("blur"!==e.type&&(e=function(e){e=e.value.substring(0,e.selectionStart);if(/\S$/.test(e))return e.match(/\S*$/)[0];return""}(l))?(t=e,clearTimeout(n),n=setTimeout(c,o.debounce)):p())}async function c(){var e;t&&((i=await o.onQuery(t)).length?(s||(s=document.createElement("div"),Object.assign(s.style,{width:window.getComputedStyle(l).width,position:"fixed",left:l.offsetLeft+"px",top:l.offsetTop+l.offsetHeight+"px"}),s.classList.add("floatype"),l.parentNode.insertBefore(s,l.nextSibling)),s.innerHTML="",e=function(e){var t=e.value.substring(0,e.selectionStart),t=Math.max(t.lastIndexOf("\n"),t.lastIndexOf(" "))+1,n="floatype-caret",t=(r.innerHTML=e.value.substring(0,t)+`<span id="${n}" style="display: inline-block;"></span>`,document.getElementById(n)),n=e.getBoundingClientRect();return{x:n.left+t.offsetLeft-e.scrollLeft,y:n.top+t.offsetTop-e.scrollTop+(parseInt(getComputedStyle(t).height)+5)}}(l),s.style.left=e.x+"px",s.style.top=e.y+"px",i.forEach((e,t)=>{var n=document.createElement("div");n.classList.add("floatype-item"),o.onRender?n.appendChild(o.onRender(e)):n.innerText=e,t===a&&n.classList.add("floatype-sel"),n.addEventListener("mousedown",()=>f(t)),s.appendChild(n)})):p())}function d(e,t){t.preventDefault();t=s.querySelector(`:nth-child(${a+1})`);t&&t.classList.remove("floatype-sel"),a=(a+e+i.length)%i.length,s.querySelector(`:nth-child(${a+1})`).classList.add("floatype-sel")}function f(e){var t,n,e=o.onSelect?o.onSelect(i[e]):i[e];t=l,e=e,n=Math.max(t.value.lastIndexOf(" ",t.selectionStart-1),t.value.lastIndexOf("\n",t.selectionStart-1))+1,t.value=t.value.substring(0,n)+e+(" "!==t.value[t.selectionStart]?" ":"")+t.value.substring(t.selectionStart),t.setSelectionRange(n+e.length+1,n+e.length+1),setTimeout(()=>l.focus(),50)}function p(){i=[],a=0,t=null,s&&(s.remove(),s=null)}return["input","keydown","blur"].forEach(e=>l.addEventListener(e,u)),{unbind:function(){["input","keydown","blur"].forEach(e=>l.removeEventListener(e,u)),p(),r.remove()}}}export default floatype;export{floatype};